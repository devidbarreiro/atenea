{% load static %}

<form method="post" id="musicForm" class="p-6">
    {% csrf_token %}
    
    <!-- Nombre -->
    <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">
            Nombre de la Pista <span class="text-red-500">*</span>
        </label>
        <input 
            type="text" 
            name="name" 
            required 
            placeholder="Ej: Epic Background Music"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
        >
        <p class="text-xs text-gray-500 mt-1">Dale un nombre descriptivo a la m√∫sica</p>
    </div>
    
    <!-- Prompt Musical -->
    <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">
            Descripci√≥n del Estilo Musical <span class="text-red-500">*</span>
        </label>
        <textarea 
            name="prompt" 
            required 
            rows="8"
            id="music-prompt"
            placeholder="Create an intense, fast-paced electronic track for a high-adrenaline video scene. Use driving synth arpeggios, punchy drums, distorted bass, glitch effects, and aggressive rhythmic textures. The tempo should be fast, 130‚Äì150 bpm, with rising tension, quick transitions, and dynamic energy bursts."
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all resize-none font-mono text-sm"
        ></textarea>
        <div class="flex justify-between mt-1">
            <p class="text-xs text-gray-500">Describe el estilo, instrumentos, tempo, mood y atm√≥sfera deseados (en ingl√©s)</p>
            <span id="char-count" class="text-xs text-gray-400">0 caracteres</span>
        </div>
    </div>
    
    <!-- Duraci√≥n -->
    <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700 mb-2">
            Duraci√≥n <span class="text-red-500">*</span>
        </label>
        <div class="flex items-center gap-3">
            <input 
                type="number" 
                name="duration_sec" 
                id="duration_sec" 
                value="30" 
                min="5" 
                max="300" 
                required
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all text-center text-2xl font-bold"
            >
            <span class="text-gray-600 font-semibold">segundos</span>
        </div>
        <input 
            type="range" 
            min="5" 
            max="300" 
            value="30" 
            step="5" 
            id="duration-slider"
            class="w-full mt-4"
            oninput="document.getElementById('duration_sec').value = this.value"
        >
        <div class="flex justify-between text-xs text-gray-500 mt-2">
            <span>5s</span>
            <span>150s</span>
            <span>300s (5min)</span>
        </div>
    </div>
    
    <!-- Ejemplos de Prompts -->
    <div class="mb-6 bg-purple-50 border border-purple-200 rounded-lg p-4">
        <h3 class="text-sm font-bold text-purple-900 mb-3">üí° Ejemplos de Prompts</h3>
        <div class="space-y-2">
            <button type="button" onclick="setPrompt('cinematic')" class="w-full text-left p-3 bg-white rounded-lg hover:bg-purple-50 transition text-xs">
                <strong class="text-purple-900">Cinematogr√°fico √âpico:</strong>
                <p class="text-gray-700 mt-1">Create a cinematic orchestral piece with soaring strings, powerful brass, and epic percussion...</p>
            </button>
            <button type="button" onclick="setPrompt('ambient')" class="w-full text-left p-3 bg-white rounded-lg hover:bg-purple-50 transition text-xs">
                <strong class="text-purple-900">Ambiental Relajante:</strong>
                <p class="text-gray-700 mt-1">Create a calm, atmospheric ambient piece with soft synth pads, gentle piano melodies...</p>
            </button>
            <button type="button" onclick="setPrompt('upbeat')" class="w-full text-left p-3 bg-white rounded-lg hover:bg-purple-50 transition text-xs">
                <strong class="text-purple-900">Corporativo Optimista:</strong>
                <p class="text-gray-700 mt-1">Create an upbeat, positive corporate track with acoustic guitar, light piano...</p>
            </button>
            <button type="button" onclick="setPrompt('electronic')" class="w-full text-left p-3 bg-white rounded-lg hover:bg-purple-50 transition text-xs">
                <strong class="text-purple-900">Electr√≥nico En√©rgico:</strong>
                <p class="text-gray-700 mt-1">Create an intense, fast-paced electronic track for a high-adrenaline scene...</p>
            </button>
        </div>
    </div>
    
    <!-- Info -->
    <div class="mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
        <h3 class="text-sm font-bold text-blue-900 mb-2">üéµ Caracter√≠sticas</h3>
        <ul class="text-xs text-blue-800 space-y-1">
            <li>‚Ä¢ M√∫sica original generada con IA</li>
            <li>‚Ä¢ M√∫ltiples estilos y g√©neros</li>
            <li>‚Ä¢ Control de tempo y mood</li>
            <li>‚Ä¢ Alta calidad de audio</li>
            <li>‚Ä¢ Sin derechos de autor</li>
        </ul>
    </div>
    
    <!-- Advertencia Copyright -->
    <div class="mb-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
        <h3 class="text-sm font-bold text-yellow-900 mb-2">‚ö†Ô∏è Importante</h3>
        <ul class="text-xs text-yellow-800 space-y-1">
            <li>‚Ä¢ No menciones artistas o bandas por nombre</li>
            <li>‚Ä¢ No uses letras protegidas por copyright</li>
            <li>‚Ä¢ Describe el estilo, no copies</li>
        </ul>
    </div>
    
    <!-- Botones -->
    <div class="flex gap-3 justify-end pt-6 border-t border-gray-200">
        {% if project %}
        <a href="{% url 'core:project_music' project.id %}" 
           class="bg-gray-100 text-gray-700 hover:bg-gray-200 px-6 py-3 rounded-md font-medium transition-colors">
            Cancelar
        </a>
        {% else %}
        <a href="{% url 'core:dashboard' %}" 
           class="bg-gray-100 text-gray-700 hover:bg-gray-200 px-6 py-3 rounded-md font-medium transition-colors">
            Cancelar
        </a>
        {% endif %}
        <button 
            type="submit" 
            class="bg-black text-white hover:bg-gray-800 px-6 py-3 rounded-md font-medium transition-colors">
            Crear M√∫sica
        </button>
    </div>
</form>

<script>
// Contador de caracteres
const textarea = document.getElementById('music-prompt');
const charCount = document.getElementById('char-count');
if (textarea && charCount) {
    textarea.addEventListener('input', () => {
        charCount.textContent = `${textarea.value.length} caracteres`;
    });
    // Inicializar contador
    charCount.textContent = `${textarea.value.length} caracteres`;
}

// Sincronizar slider con input
const slider = document.getElementById('duration-slider');
const durationInput = document.getElementById('duration_sec');

if (slider && durationInput) {
    slider.addEventListener('input', () => {
        durationInput.value = slider.value;
    });

    durationInput.addEventListener('input', () => {
        slider.value = durationInput.value;
    });
}

// Funci√≥n para establecer prompts de ejemplo
function setPrompt(type) {
    const prompts = {
        'cinematic': 'Create a cinematic orchestral piece with soaring strings, powerful brass, and epic percussion. Build from quiet contemplation to triumphant crescendo. Include choir elements and dynamic tempo changes. Evoke feelings of hope, victory, and inspiration.',
        'ambient': 'Create a calm, atmospheric ambient piece with soft synth pads, gentle piano melodies, and subtle nature sounds. Use slow tempo (60-80 bpm), reverb-heavy textures, and evolving soundscapes. Perfect for meditation or background focus music.',
        'upbeat': 'Create an upbeat, positive corporate track with acoustic guitar, light piano, and subtle percussion. Use major key, steady rhythm (120 bpm), and bright, motivational melody. Inspire confidence and forward movement.',
        'electronic': 'Create an intense, fast-paced electronic track for a high-adrenaline scene. Use driving synth arpeggios, punchy drums, distorted bass, glitch effects. Tempo 130‚Äì150 bpm with rising tension and dynamic energy bursts.'
    };
    
    if (textarea) {
        textarea.value = prompts[type];
        if (charCount) {
            charCount.textContent = `${textarea.value.length} caracteres`;
        }
    }
}
</script>

