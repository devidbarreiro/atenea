{% load static %}

{% if active_tasks %}
    <div class="divide-y divide-gray-200">
        {% for task in active_tasks %}
        <div class="px-3 py-2.5 hover:bg-gray-50 transition-colors group" 
             data-task-uuid="{{ task.uuid }}">
            <div class="flex items-center gap-2">
                <!-- Icono pequeño -->
                <div class="flex-shrink-0">
                    {% if task.task_type == 'video' %}
                        <div class="w-8 h-8 rounded bg-purple-100 flex items-center justify-center">
                            <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                    {% elif task.task_type == 'image' %}
                        <div class="w-8 h-8 rounded bg-green-100 flex items-center justify-center">
                            <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                    {% elif task.task_type == 'audio' %}
                        <div class="w-8 h-8 rounded bg-blue-100 flex items-center justify-center">
                            <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                            </svg>
                        </div>
                    {% endif %}
                    {% if task.status == 'processing' %}
                    <div class="absolute -top-0.5 -right-0.5 w-3 h-3 bg-blue-500 rounded-full border-2 border-white"></div>
                    {% endif %}
                </div>
                
                <!-- Contenido -->
                <div class="flex-1 min-w-0">
                    <p class="text-xs font-medium text-gray-900 truncate">
                        {% if task.metadata.prompt %}
                            {{ task.metadata.prompt|truncatewords:4 }}
                        {% elif task.metadata.text %}
                            {{ task.metadata.text|truncatewords:4 }}
                        {% else %}
                            {{ task.get_task_type_display|capfirst }}
                        {% endif %}
                    </p>
                    <p class="text-xs text-gray-500 mt-0.5">
                        {{ task.get_status_display }}
                    </p>
                </div>
                
                <!-- Botón cancelar -->
                {% if task.status == 'queued' or task.status == 'processing' %}
                <button 
                    hx-post="{% url 'core:cancel_task' task.uuid %}"
                    hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                    hx-confirm="¿Cancelar?"
                    hx-target="#active-queues-content"
                    hx-swap="innerHTML"
                    hx-on::after-request="
                        window.dispatchEvent(new CustomEvent('task-status-changed'));
                        window.dispatchEvent(new CustomEvent('queues-updated'));
                    "
                    class="flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-red-100 text-gray-400 hover:text-red-600"
                    title="Cancelar">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
{% endif %}

