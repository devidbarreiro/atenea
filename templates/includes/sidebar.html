{% load static %}
{% url 'core:dashboard' as dashboard_url %}
{% url 'core:project_create' as project_create_url %}

<div x-data="{ 
    sidebarCollapsed: localStorage.getItem('sidebarCollapsed') === 'true',
    mobileMenuOpen: false,
    toggleSidebar() {
        this.sidebarCollapsed = !this.sidebarCollapsed;
        localStorage.setItem('sidebarCollapsed', this.sidebarCollapsed);
        // Disparar evento para sincronizar con otros componentes
        window.dispatchEvent(new CustomEvent('sidebar-toggled', { detail: { collapsed: this.sidebarCollapsed } }));
    },
    toggleMobileMenu() {
        this.mobileMenuOpen = !this.mobileMenuOpen;
    }
}" 
@open-mobile-menu.window="mobileMenuOpen = true"
@close-mobile-menu.window="mobileMenuOpen = false"
:class="{ 
    'w-16': sidebarCollapsed && !mobileMenuOpen, 
    'w-64': !sidebarCollapsed || mobileMenuOpen,
    '-translate-x-full lg:translate-x-0': !mobileMenuOpen,
    'translate-x-0': mobileMenuOpen
}"
class="fixed left-0 top-0 h-screen bg-white border-r border-gray-200 z-40 transition-all duration-300 flex flex-col lg:translate-x-0"
x-init="sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true'; window.addEventListener('sidebar-toggled', (e) => { sidebarCollapsed = e.detail.collapsed; })">

    <!-- Logo y bot贸n colapsar -->
    <div class="flex items-center justify-between p-4 border-b border-gray-200 h-16">
        <div class="flex items-center flex-1 min-w-0" :class="{ 'justify-center': sidebarCollapsed }">
            <a href="{{ dashboard_url }}" class="flex items-center space-x-2" x-show="!sidebarCollapsed">
                <span class="text-2xl"></span>
                <span class="text-xl font-bold text-gray-900">Atenea</span>
            </a>
            <button @click="toggleSidebar()" 
                    class="p-2 rounded-md hover:bg-gray-100 transition-colors"
                    x-show="sidebarCollapsed"
                    title="Expandir sidebar">
                <span class="text-2xl"></span>
            </button>
        </div>
        <button @click="toggleSidebar()" 
                class="p-1 rounded-md hover:bg-gray-100 transition-colors flex-shrink-0"
                x-show="!sidebarCollapsed"
                title="Colapsar sidebar">
            <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path>
            </svg>
        </button>
    </div>

    <!-- Botones Crear y Nuevo Proyecto -->
    <div class="p-4 space-y-2 border-b border-gray-200">
        <button @click="$dispatch('open-create-modal')"
                class="w-full bg-black text-white py-2.5 rounded-lg font-medium hover:bg-gray-800 transition-colors flex items-center justify-center"
                :class="sidebarCollapsed ? 'px-2' : 'px-4 space-x-2'"
                :title="sidebarCollapsed ? 'Crear' : ''">
            <span x-show="sidebarCollapsed" class="text-xl font-bold">+</span>
            <template x-if="!sidebarCollapsed">
                <div class="flex items-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    <span>Crear</span>
                </div>
            </template>
        </button>
        <a href="{{ project_create_url }}"
           class="w-full bg-gray-100 text-gray-900 py-2 rounded-lg font-medium hover:bg-gray-200 transition-colors flex items-center justify-center"
           :class="sidebarCollapsed ? 'px-2' : 'px-4 space-x-2'"
           :title="sidebarCollapsed ? 'Nuevo Proyecto' : ''">
            <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
            </svg>
            <span x-show="!sidebarCollapsed">Nuevo Proyecto</span>
        </a>
    </div>

    <!-- Navegaci贸n Principal -->
    <nav class="flex-1 overflow-y-auto py-4">
        <div class="px-2 space-y-1">
            <!-- Inicio -->
            <a href="{{ dashboard_url }}"
               class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors {% if request.path == dashboard_url %}bg-gray-100 text-gray-900{% else %}text-gray-700 hover:bg-gray-50{% endif %}"
               :class="{ 'justify-center': sidebarCollapsed }"
               :title="sidebarCollapsed ? 'Inicio' : ''">
                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
                </svg>
                <span x-show="!sidebarCollapsed">Inicio</span>
            </a>

            <!-- Proyectos -->
            <a href="{% url 'core:projects_list' %}"
               class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors {% if request.resolver_match.url_name == 'projects_list' %}bg-gray-100 text-gray-900{% else %}text-gray-700 hover:bg-gray-50{% endif %}"
               :class="{ 'justify-center': sidebarCollapsed }"
               :title="sidebarCollapsed ? 'Proyectos' : ''">
                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>
                </svg>
                <span x-show="!sidebarCollapsed">Proyectos</span>
            </a>

            <!-- Agente de Video -->
            <a href="#"
               class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-50"
               :class="{ 'justify-center': sidebarCollapsed }"
               :title="sidebarCollapsed ? 'Agente de Video' : ''">
                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                </svg>
                <span x-show="!sidebarCollapsed" class="flex-1">Agente de Video</span>
                <span x-show="!sidebarCollapsed" class="text-xs bg-blue-100 text-blue-800 px-2 py-0.5 rounded">Beta</span>
            </a>

            <!-- Biblioteca -->
            <a href="{% url 'core:library' %}"
               class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors {% if request.resolver_match.url_name == 'library' %}bg-gray-100 text-gray-900{% else %}text-gray-700 hover:bg-gray-50{% endif %}"
               :class="{ 'justify-center': sidebarCollapsed }"
               :title="sidebarCollapsed ? 'Biblioteca' : ''">
                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                </svg>
                <span x-show="!sidebarCollapsed">Biblioteca</span>
            </a>
        </div>

        <!-- Secci贸n Anclados -->
        <div class="px-4 py-2 mt-4">
            <div x-show="!sidebarCollapsed" class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Anclados</div>
            <div class="space-y-1">
                <a href="{% url 'core:video_create_standalone' %}"
                   class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-50"
                   :class="{ 'justify-center': sidebarCollapsed }"
                   :title="sidebarCollapsed ? 'Generar Video' : ''">
                    <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                    </svg>
                    <span x-show="!sidebarCollapsed">Generar Video</span>
                </a>
                <a href="{% url 'core:image_create_standalone' %}"
                   class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-50"
                   :class="{ 'justify-center': sidebarCollapsed }"
                   :title="sidebarCollapsed ? 'Generar Imagen' : ''">
                    <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    <span x-show="!sidebarCollapsed">Generar Imagen</span>
                </a>
                <a href="{% url 'core:audio_create_standalone' %}"
                   class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-50"
                   :class="{ 'justify-center': sidebarCollapsed }"
                   :title="sidebarCollapsed ? 'Generar Audio' : ''">
                    <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                    </svg>
                    <span x-show="!sidebarCollapsed">Generar Audio</span>
                </a>
                <div class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors text-gray-500 opacity-75 cursor-not-allowed relative"
                   :class="{ 'justify-center': sidebarCollapsed }"
                   :title="sidebarCollapsed ? 'Generar M煤sica' : ''">
                    <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path>
                    </svg>
                    <span x-show="!sidebarCollapsed" class="flex-1">Generar M煤sica</span>
                    <span x-show="!sidebarCollapsed" class="text-xs bg-gray-200 text-gray-600 px-1.5 py-0.5 rounded">Pr贸ximamente</span>
                </div>
                <a href="{% url 'core:script_create_standalone' %}"
                   class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-50"
                   :class="{ 'justify-center': sidebarCollapsed }"
                   :title="sidebarCollapsed ? 'Generar Gui贸n' : ''">
                    <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span x-show="!sidebarCollapsed">Generar Gui贸n</span>
                </a>
            </div>
        </div>

        <!-- Secci贸n Assets -->
        <div class="px-4 py-2 mt-4" x-data="{ assetsOpen: false }">
            <button @click="assetsOpen = !assetsOpen"
                    class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-50 w-full"
                    :class="{ 'justify-center': sidebarCollapsed }"
                    :title="sidebarCollapsed ? 'Assets' : ''">
                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                </svg>
                <span x-show="!sidebarCollapsed" class="flex-1 text-left">Assets</span>
                <svg x-show="!sidebarCollapsed && !assetsOpen" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
                <svg x-show="!sidebarCollapsed && assetsOpen" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                </svg>
            </button>
            <div x-show="assetsOpen && !sidebarCollapsed" class="ml-8 mt-1 space-y-1">
                <a href="#" class="block px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Videos</a>
                <a href="#" class="block px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Im谩genes</a>
                <a href="#" class="block px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Audios</a>
                <a href="#" class="block px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-50">M煤sica</a>
                <a href="#" class="block px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Guiones</a>
            </div>
        </div>

        <!-- Secci贸n Recursos -->
        <div class="px-4 py-2 mt-4" x-data="{ recursosOpen: false }">
            <button @click="recursosOpen = !recursosOpen"
                    class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-50 w-full"
                    :class="{ 'justify-center': sidebarCollapsed }"
                    :title="sidebarCollapsed ? 'Recursos' : ''">
                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                </svg>
                <span x-show="!sidebarCollapsed" class="flex-1 text-left">Recursos</span>
                <svg x-show="!sidebarCollapsed && !recursosOpen" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
                <svg x-show="!sidebarCollapsed && recursosOpen" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                </svg>
            </button>
            <div x-show="recursosOpen && !sidebarCollapsed" class="ml-8 mt-1 space-y-1">
                <a href="#" class="block px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Avatares</a>
                <a href="#" class="block px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Voces</a>
                <a href="#" class="block px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Plantillas</a>
                <a href="#" class="block px-3 py-2 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Freepik</a>
            </div>
        </div>

        <!-- Historial -->
        <div class="px-2 mt-4">
            <a href="#"
               class="flex items-center space-x-3 px-3 py-2 rounded-lg transition-colors text-gray-700 hover:bg-gray-50"
               :class="{ 'justify-center': sidebarCollapsed }"
               :title="sidebarCollapsed ? 'Historial' : ''">
                <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                <span x-show="!sidebarCollapsed">Historial</span>
            </a>
        </div>
    </nav>

    <!-- Secci贸n Inferior -->
    <div class="border-t border-gray-200 p-4 space-y-2">
        <!-- Banner Upgrade (opcional) -->
        <div x-show="!sidebarCollapsed" class="bg-gray-100 rounded-lg p-3 text-center">
            <div class="text-sm font-semibold text-gray-900 mb-1">Upgrade</div>
            <div class="text-xs text-gray-600">Desbloquea m谩s funciones</div>
        </div>

        <!-- Barra de utilidades -->
        <div class="flex items-center" :class="sidebarCollapsed ? 'justify-center' : 'justify-between'">
            <a href="/docs/" class="p-2 rounded-lg hover:bg-gray-100 transition-colors" :title="sidebarCollapsed ? 'Ayuda' : ''">
                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </a>
            <button x-show="!sidebarCollapsed" class="p-2 rounded-lg hover:bg-gray-100 transition-colors relative" title="Notificaciones">
                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                </svg>
                <span class="absolute top-1 right-1 w-2 h-2 bg-blue-500 rounded-full"></span>
            </button>
            <button x-show="!sidebarCollapsed" class="p-2 rounded-lg hover:bg-gray-100 transition-colors" title="Tema">
                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                </svg>
            </button>
            <div class="relative" x-data="{ userMenuOpen: false }">
                <button @click="userMenuOpen = !userMenuOpen"
                        class="w-9 h-9 rounded-full bg-gray-200 hover:bg-gray-300 transition-colors flex items-center justify-center"
                        title="Usuario">
                    <span class="text-sm font-medium text-gray-700">
                        {% if user.first_name and user.last_name %}
                            {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                        {% else %}
                            {{ user.username|slice:":2"|upper }}
                        {% endif %}
                    </span>
                </button>
                <div x-show="userMenuOpen" 
                     @click.away="userMenuOpen = false"
                     x-cloak
                     :class="sidebarCollapsed ? 'left-full ml-2 bottom-0' : 'bottom-full right-0 mb-2'"
                     class="absolute w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-50">
                    <!-- User info -->
                    <div class="px-4 py-3 border-b border-gray-200">
                        <div class="text-sm font-medium text-gray-900 truncate">{{ user.username }}</div>
                        <div class="text-xs text-gray-500 truncate">{{ user.email }}</div>
                    </div>
                    <!-- Menu items -->
                    <div class="py-1">
                        <a href="/admin/" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Admin</a>
                        <a href="{% url 'core:user_menu' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Gestionar usuarios</a>
                        <a href="{% url 'core:logout' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Cerrar sesi贸n</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


