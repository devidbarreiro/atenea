<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" id="script-modal">
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center p-6 border-b">
            <h3 class="text-lg font-semibold text-gray-900">
                <i class="fas fa-file-alt me-2"></i>
                Nuevo Guión
            </h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="p-6">
            <form method="post" 
                  hx-post="{% url 'core:script_create' project_id=project.pk %}"
                  hx-target="#script-form-container"
                  hx-swap="innerHTML"
                  hx-indicator="#loading-spinner">
                
                <div id="script-form-container">
                    {% csrf_token %}
                    
                    <div class="mb-4">
                        <label for="{{ form.title.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            {{ form.title.label }}
                        </label>
                        {{ form.title }}
                        {% if form.title.help_text %}
                            <p class="text-sm text-gray-500 mt-1">{{ form.title.help_text }}</p>
                        {% endif %}
                    </div>

                    <div class="mb-4">
                        <label for="{{ form.original_script.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                            {{ form.original_script.label }}
                        </label>
                        {{ form.original_script }}
                        {% if form.original_script.help_text %}
                            <p class="text-sm text-gray-500 mt-1">{{ form.original_script.help_text }}</p>
                        {% endif %}
                        <div class="mt-2">
                            <small class="text-gray-500">
                                <span id="char-count">0</span> caracteres
                            </small>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="id_desired_duration_min" class="block text-sm font-medium text-gray-700 mb-2">
                            Duración Deseada (minutos)
                        </label>
                        <input type="number" 
                               name="desired_duration_min" 
                               id="id_desired_duration_min"
                               min="1"
                               max="60"
                               value="5"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"
                               placeholder="5">
                        <p class="mt-1 text-sm text-gray-500">Duración aproximada del video final (1-60 minutos)</p>
                    </div>

                    <div class="bg-blue-50 border border-blue-200 rounded-md p-4 mb-4">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-info-circle text-blue-400"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-blue-700">
                                    <strong>Procesamiento automático:</strong> Tu guión será procesado automáticamente por nuestro agente de IA y estructurado en escenas.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="closeModal()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-orange-500 hover:bg-orange-600 rounded-md transition-colors">
                            <i class="fas fa-paper-plane me-2"></i>
                            Crear Guión
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Loading Spinner -->
<div id="loading-spinner" class="htmx-indicator">
    <div class="flex justify-center items-center py-8">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"></div>
        <span class="ml-3 text-gray-600">Procesando guión...</span>
    </div>
</div>

<script>
function closeModal() {
    document.getElementById('script-modal').remove();
}

document.addEventListener('DOMContentLoaded', function() {
    // Contador de caracteres
    const scriptTextarea = document.querySelector('textarea[name="original_script"]');
    const charCount = document.getElementById('char-count');
    
    if (scriptTextarea && charCount) {
        scriptTextarea.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });
    }
    
    // Auto-resize textarea
    if (scriptTextarea) {
        scriptTextarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });
    }
    
    // Cerrar modal con Escape
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeModal();
        }
    });
});
</script>
