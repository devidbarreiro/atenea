{% extends 'base.html' %}
{% load static %}

{% block title %}Menú de Usuarios - Atenea{% endblock %}

{% block content %}
<div class="mb-8">
    <h1 class="text-4xl font-bold mb-2">Menú de Usuarios</h1>
    <p class="text-gray-600">Elige entre crear un usuario o administrarlos</p>
</div>

<!-- Content Options -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
    <!-- Create Users Card -->
    <div id="user-create-card" 
         onclick="selectContentType('user-create')"   
         class="content-card cursor-pointer bg-white rounded-lg border-2 border-gray-300 p-6 hover:border-blue-600 hover:shadow-xl transition-all duration-300">
        <div class="flex flex-col items-center text-center">
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-8">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">Crear Usuarios</h3>
            <p class="text-gray-600 text-sm">Crea un usuario de cero con su correo, nombre de usuario, contraseña y permisos</p>
        </div>
    </div>

    <!-- Admin Users Card -->
    <div id="user-admin-card" 
         onclick="selectContentType('user-admin')"
         class="content-card cursor-pointer bg-white rounded-lg border-2 border-gray-300 hover:border-blue-600 p-6 hover:shadow-xl transition-all duration-300">
        <div class="flex flex-col items-center text-center">
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-8">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-900 mb-2">Administrar Usuarios</h3>
            <p class="text-gray-600 text-sm">Consulta una lista con todos los usuarios, elimina o cambia su correo, nombre de usuario, contraseña y permisos</p>
        </div>
    </div>
</div>

<!-- Mensajes -->

<div class="container mx-auto mt-4">
    {% for message in messages %}
        <div x-data="{ show: true }" x-show="show" 
             class="border px-4 py-3 rounded mb-6 relative
                {% if message.tags == 'success' %}
                    bg-green-100 border-green-400 text-green-700
                {% elif message.tags == 'error' %}
                    bg-red-100 border-red-400 text-red-700
                {% endif %}"
             role="alert">
            
            <span class="whitespace-pre-line">{{ message}}</span>
            
            <button @click="show = false" 
                    class="absolute top-0 right-0 mt-2 mr-2 text-lg font-bold focus:outline-none">
                &times;
            </button>
        </div>
    {% endfor %}
</div>




<!-- User Form - Create -->
<div id="user-create-form" class="hidden w-full p-6 content flex justify-center">
    <form method="post" class="bg-white p-10 rounded-xl shadow-lg w-96 border-t-4 border-black transition-all hover:shadow-2xl">
        
        {% csrf_token %}

        <!-- Usuario -->
        <div class="relative mb-6">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                <!-- Heroicon User -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                </svg>
            </span>
            <input type="text" name="username" placeholder="Usuario" autocomplete="off"
                   class="w-full pl-10 pr-3 py-2 border-b-2 border-gray-300 text-gray-700 focus:border-black focus:ring-1 focus:ring-black focus:text-black outline-none rounded-sm transition-colors font-medium">
        </div>

        <!-- Correo -->
        <div class="relative mb-6">
            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                <!-- Heroicon Envelope -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75" />
                </svg>
            </span>
            <input type="text" name="email" placeholder="Correo" autocomplete="off"
                   class="w-full pl-10 pr-3 py-2 border-b-2 border-gray-300 text-gray-700 focus:border-black focus:ring-1 focus:ring-black focus:text-black outline-none rounded-sm transition-colors font-medium">
        </div>

        <!-- Contraseña -->
        <div class="relative mb-4" x-data="{ show: false }">

            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                <!-- Heroicon Lock -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
                </svg>
            </span>

            <input :type="show ? 'text' : 'password'" name="password" placeholder="Contraseña"
                   class="w-full pl-10 pr-10 py-2 border-b-2 border-gray-300 text-gray-700 focus:text-black focus:border-black focus:ring-1 focus:ring-black outline-none rounded-sm transition-colors font-medium">
            
            <button type="button" @click="show = !show"
                    class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 focus:outline-none" tabindex="-1">

                <!-- Heroicon Eye -->
                <svg x-show="!show" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" 
                    stroke-width="1.5" stroke="currentColor" class="h-5 w-5">
                    <path stroke-linecap="round" stroke-linejoin="round" 
                        d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" 
                        d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                </svg>

                <!-- Heroicon Eye Slash -->
                <svg x-show="show" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" 
                    stroke-width="1.5" stroke="currentColor" class="h-5 w-5">
                    <path stroke-linecap="round" stroke-linejoin="round" 
                        d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88" />
                </svg>
            </button>
        </div>

        <!-- Confirmar contraseña -->
        <div class="relative mb-4" x-data="{ show: false }">

            <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                <!-- Heroicon Lock -->
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
                </svg>
            </span>

            <input :type="show ? 'text' : 'password'" name="password_confirm" placeholder="Confirmar Contraseña"
                   class="w-full pl-10 pr-10 py-2 border-b-2 border-gray-300 text-gray-700 focus:text-black focus:border-black focus:ring-1 focus:ring-black outline-none rounded-sm transition-colors font-medium">
                
           <button type="button" @click="show = !show"
                    class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 focus:outline-none" tabindex="-1">

                <!-- Heroicon Eye -->
                <svg x-show="!show" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" 
                    stroke-width="1.5" stroke="currentColor" class="h-5 w-5">
                    <path stroke-linecap="round" stroke-linejoin="round" 
                        d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" 
                        d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                </svg>

                <!-- Heroicon Eye Slash -->
                <svg x-show="show" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" 
                    stroke-width="1.5" stroke="currentColor" class="h-5 w-5">
                    <path stroke-linecap="round" stroke-linejoin="round" 
                        d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.242 4.242L9.88 9.88" />
                </svg>
            </button>
        </div>

        <!-- Botón -->
        <button type="submit" class="w-full bg-black text-white py-2 rounded-lg hover:bg-gray-900 transition-colors font-semibold text-lg">
            Crear Usuario
        </button>
    </form>
</div>

<!-- Script Form - Admin -->
<div id="user-admin-form" 
     class="hidden w-full bg-white p-6 rounded-md shadow overflow-y-auto"
     style="max-height: calc(100vh - 600px);"
     x-data="{ search: ''}">

     <div class="mb-4">
        <input type="text" 
               placeholder="Buscar usuario..." 
               x-model="search"
               class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300">
    </div>
    <table class="min-w-full bg-white border border-gray-200">
        <thead class="bg-gray-100">
            <tr>
                <th class="px-4 py-2 text-left border-b border-gray-200 w-2"></th>
                <th class="px-4 py-2 text-left border-b border-gray-200">Username</th>
                <th class="px-4 py-2 text-left border-b border-gray-200">Email</th>
                <th class="px-4 py-2 text-left border-b border-gray-200">Staff</th>
                <th class="px-4 py-2 text-left border-b border-gray-200">Active</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr class="hover:bg-gray-50"
                x-show="search === '' || '{{ user.username }}'.toLowerCase().includes(search.toLowerCase())">
                <td class="px-4 py-2 border-b border-gray-200">
                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600">
                </td>
                <td class="px-4 py-2 border-b border-gray-200">{{ user.username }}</td>
                <td class="px-4 py-2 border-b border-gray-200">{{ user.email }}</td>
                <td class="px-4 py-2 border-b border-gray-200">{{ user.is_staff }}</td>
                <td class="px-4 py-2 border-b border-gray-200">{{ user.is_active }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
function selectContentType(type) {
    const cards = ['user-create-card', 'user-admin-card'];
    const forms = ['user-create-form', 'user-admin-form'];

    cards.forEach(card => document.getElementById(card).classList.replace('border-blue-600', 'border-gray-300'));
    forms.forEach(form => document.getElementById(form).classList.add('hidden'));

    if (type === 'user-create') {
        document.getElementById('user-create-card').classList.replace('border-gray-300', 'border-blue-600');
        document.getElementById('user-create-form').classList.remove('hidden');
        document.getElementById('user-create-form').scrollIntoView({ behavior: 'smooth' });
    } else if (type === 'user-admin') {
        document.getElementById('user-admin-card').classList.replace('border-gray-300', 'border-blue-600');
        document.getElementById('user-admin-form').classList.remove('hidden');
        document.getElementById('user-admin-form').scrollIntoView({ behavior: 'smooth' });
    }
}
</script>
{% endblock %}