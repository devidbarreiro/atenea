{% extends 'base.html' %}

{% block title %}Dashboard - Atenea{% endblock %}

{% block extra_css %}
<style>
    .header-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
    }
    
    .stats-inline {
        display: flex;
        gap: 2rem;
        align-items: center;
    }
    
    .stat-item {
        display: flex;
        align-items: baseline;
        gap: 0.5rem;
    }
    
    .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
    }
    
    .stat-label {
        font-size: 0.875rem;
        color: hsl(var(--muted-foreground));
    }
    
    .projects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 1rem;
    }
    
    .project-card {
        padding: 1.5rem;
        border: 1px solid hsl(var(--border));
        border-radius: var(--radius);
        transition: border-color 0.2s;
    }
    
    .project-card:hover {
        border-color: hsl(var(--foreground));
    }
    
    .project-card h3 {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
    }
    
    .project-meta {
        font-size: 0.875rem;
        color: hsl(var(--muted-foreground));
        margin-bottom: 1rem;
    }
    
    .project-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .empty-state {
        text-align: center;
        padding: 6rem 2rem;
        border: 2px dashed hsl(var(--border));
        border-radius: var(--radius);
        color: hsl(var(--muted-foreground));
    }
    
    .empty-state-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.3;
    }
    
    .empty-state h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: hsl(var(--foreground));
        margin-bottom: 0.5rem;
    }
    
    .empty-state p {
        margin-bottom: 1.5rem;
    }

    /* Estilos para vista de cuadr√≠cula y lista */
    .content-section {
        margin-top: 2rem;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }

    .view-toggle {
        display: flex;
        gap: 0.5rem;
        border: 1px solid hsl(var(--border));
        border-radius: var(--radius);
        padding: 0.25rem;
    }

    .view-toggle button {
        padding: 0.5rem 0.75rem;
        border: none;
        background: transparent;
        cursor: pointer;
        border-radius: calc(var(--radius) - 2px);
        transition: background-color 0.2s;
    }

    .view-toggle button.active {
        background: hsl(var(--accent));
    }

    /* Vista cuadr√≠cula */
    .media-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
    }

    .media-card {
        border: 1px solid hsl(var(--border));
        border-radius: var(--radius);
        overflow: hidden;
        transition: border-color 0.2s;
        cursor: pointer;
        background: hsl(var(--card));
    }

    .media-card:hover {
        border-color: hsl(var(--foreground));
    }

    .media-thumbnail {
        position: relative;
        width: 100%;
        height: 180px;
        background: hsl(var(--muted));
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    .media-thumbnail img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .media-thumbnail video {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .media-status-badge {
        position: absolute;
        top: 0.5rem;
        left: 0.5rem;
        padding: 0.25rem 0.75rem;
        border-radius: calc(var(--radius) - 2px);
        font-size: 0.75rem;
        font-weight: 500;
    }

    .status-completed { background: hsl(142, 76%, 36%); color: white; }
    .status-processing { background: hsl(45, 93%, 47%); color: white; }
    .status-pending { background: hsl(215, 16%, 47%); color: white; }
    .status-error { background: hsl(0, 72%, 51%); color: white; }

    .media-info {
        padding: 1rem;
    }

    .media-title {
        font-weight: 600;
        margin-bottom: 0.25rem;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .media-project {
        font-size: 0.875rem;
        color: hsl(var(--muted-foreground));
        margin-bottom: 0.5rem;
    }

    .media-meta {
        font-size: 0.75rem;
        color: hsl(var(--muted-foreground));
        display: flex;
        justify-content: space-between;
    }

    /* Vista lista */
    .media-list {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .media-list-item {
        display: flex;
        gap: 1rem;
        padding: 1rem;
        border: 1px solid hsl(var(--border));
        border-radius: var(--radius);
        transition: border-color 0.2s;
        cursor: pointer;
        background: hsl(var(--card));
    }

    .media-list-item:hover {
        border-color: hsl(var(--foreground));
    }

    .media-list-thumbnail {
        width: 120px;
        height: 80px;
        background: hsl(var(--muted));
        border-radius: calc(var(--radius) - 2px);
        overflow: hidden;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .media-list-thumbnail img,
    .media-list-thumbnail video {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .media-list-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .media-list-title {
        font-weight: 600;
        margin-bottom: 0.25rem;
    }

    .media-list-details {
        font-size: 0.875rem;
        color: hsl(var(--muted-foreground));
    }

    .media-list-status {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .play-icon {
        position: absolute;
        width: 48px;
        height: 48px;
        background: rgba(0, 0, 0, 0.7);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
    }

    .hidden {
        display: none;
    }
</style>
{% endblock %}

{% block content %}
<div style="margin-bottom: 1.5rem;">
    <h2 style="margin-bottom: 0.5rem;">Dashboard</h2>
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div class="stats-inline">
            <div class="stat-item">
                <span class="stat-value">{{ projects.count }}</span>
                <span class="stat-label">proyectos</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">{{ total_videos }}</span>
                <span class="stat-label">videos</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">{{ total_images }}</span>
                <span class="stat-label">im√°genes</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">{{ completed_videos }}</span>
                <span class="stat-label">completados</span>
            </div>
            <div class="stat-item">
                <span class="stat-value">{{ processing_videos }}</span>
                <span class="stat-label">procesando</span>
            </div>
        </div>
        <a href="{% url 'core:project_create' %}" class="btn btn-primary">Nuevo Proyecto</a>
    </div>
</div>

{% if projects %}
<div class="projects-grid">
    {% for project in projects %}
    <div class="project-card">
        <h3>{{ project.name }}</h3>
        <div class="project-meta">
            <div>{{ project.video_count }} video{{ project.video_count|pluralize }}, {{ project.image_count }} imagen{{ project.image_count|pluralize:"es" }}</div>
            <div>{{ project.completed_videos }} completado{{ project.completed_videos|pluralize }}</div>
            <div>{{ project.created_at|date:"d/m/Y" }}</div>
        </div>
        <div class="project-actions">
            <a href="{% url 'core:project_detail' project.id %}" class="btn" style="flex: 1;">Ver</a>
            <a href="{% url 'core:video_create' project.id %}" class="btn btn-primary" style="flex: 1;">+ Video</a>
            <a href="{% url 'core:image_create' project.id %}" class="btn btn-primary" style="flex: 1;">+ Imagen</a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <div class="empty-state-icon">üìÅ</div>
    <h3>No hay proyectos</h3>
    <p>Crea tu primer proyecto para comenzar a generar videos con IA</p>
    <a href="{% url 'core:project_create' %}" class="btn btn-primary">Crear Primer Proyecto</a>
</div>
{% endif %}

<!-- Secci√≥n de Videos -->
{% if videos %}
<div class="content-section">
    <div class="section-header">
        <h3>Videos Recientes</h3>
        <div class="view-toggle">
            <button class="active" onclick="toggleView('videos', 'grid')" id="videos-grid-btn">
                <span>‚äû</span> Cuadr√≠cula
            </button>
            <button onclick="toggleView('videos', 'list')" id="videos-list-btn">
                <span>‚ò∞</span> Lista
            </button>
        </div>
    </div>
    
    <!-- Vista Cuadr√≠cula Videos -->
    <div id="videos-grid-view" class="media-grid">
        {% for video_data in videos_with_urls %}
        {% with video=video_data.video %}
        <a href="{% url 'core:video_detail' video.id %}" class="media-card">
            <div class="media-thumbnail">
                <span class="media-status-badge status-{{ video.status }}">
                    {{ video.get_status_display }}
                </span>
                {% if video.status == 'completed' and video_data.signed_url %}
                    <video src="{{ video_data.signed_url }}" preload="metadata"></video>
                    <div class="play-icon">‚ñ∂</div>
                {% else %}
                    <span style="font-size: 3rem; opacity: 0.3;">üé¨</span>
                {% endif %}
            </div>
            <div class="media-info">
                <div class="media-title">{{ video.title }}</div>
                <div class="media-project">üìÅ {{ video.project.name }}</div>
                <div class="media-meta">
                    <span>{{ video.get_type_display }}</span>
                    <span>{{ video.created_at|date:"d/m/Y" }}</span>
                </div>
            </div>
        </a>
        {% endwith %}
        {% endfor %}
    </div>

    <!-- Vista Lista Videos -->
    <div id="videos-list-view" class="media-list hidden">
        {% for video_data in videos_with_urls %}
        {% with video=video_data.video %}
        <a href="{% url 'core:video_detail' video.id %}" class="media-list-item">
            <div class="media-list-thumbnail">
                {% if video.status == 'completed' and video_data.signed_url %}
                    <video src="{{ video_data.signed_url }}" preload="metadata"></video>
                {% else %}
                    <span style="font-size: 2rem; opacity: 0.3;">üé¨</span>
                {% endif %}
            </div>
            <div class="media-list-content">
                <div class="media-list-title">{{ video.title }}</div>
                <div class="media-list-details">
                    <span>üìÅ {{ video.project.name }}</span>
                    <span style="margin-left: 1rem;">{{ video.get_type_display }}</span>
                    <span style="margin-left: 1rem;">{{ video.created_at|date:"d/m/Y H:i" }}</span>
                </div>
            </div>
            <div class="media-list-status">
                <span class="media-status-badge status-{{ video.status }}">
                    {{ video.get_status_display }}
                </span>
            </div>
        </a>
        {% endwith %}
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Secci√≥n de Im√°genes -->
{% if images %}
<div class="content-section">
    <div class="section-header">
        <h3>Im√°genes Recientes</h3>
        <div class="view-toggle">
            <button class="active" onclick="toggleView('images', 'grid')" id="images-grid-btn">
                <span>‚äû</span> Cuadr√≠cula
            </button>
            <button onclick="toggleView('images', 'list')" id="images-list-btn">
                <span>‚ò∞</span> Lista
            </button>
        </div>
    </div>
    
    <!-- Vista Cuadr√≠cula Im√°genes -->
    <div id="images-grid-view" class="media-grid">
        {% for image_data in images_with_urls %}
        {% with image=image_data.image %}
        <a href="{% url 'core:image_detail' image.id %}" class="media-card">
            <div class="media-thumbnail">
                <span class="media-status-badge status-{{ image.status }}">
                    {{ image.get_status_display }}
                </span>
                {% if image.status == 'completed' and image_data.signed_url %}
                    <img src="{{ image_data.signed_url }}" alt="{{ image.title }}">
                {% else %}
                    <span style="font-size: 3rem; opacity: 0.3;">üñºÔ∏è</span>
                {% endif %}
            </div>
            <div class="media-info">
                <div class="media-title">{{ image.title }}</div>
                <div class="media-project">üìÅ {{ image.project.name }}</div>
                <div class="media-meta">
                    <span>{{ image.get_type_display }}</span>
                    <span>{{ image.created_at|date:"d/m/Y" }}</span>
                </div>
            </div>
        </a>
        {% endwith %}
        {% endfor %}
    </div>

    <!-- Vista Lista Im√°genes -->
    <div id="images-list-view" class="media-list hidden">
        {% for image_data in images_with_urls %}
        {% with image=image_data.image %}
        <a href="{% url 'core:image_detail' image.id %}" class="media-list-item">
            <div class="media-list-thumbnail">
                {% if image.status == 'completed' and image_data.signed_url %}
                    <img src="{{ image_data.signed_url }}" alt="{{ image.title }}">
                {% else %}
                    <span style="font-size: 2rem; opacity: 0.3;">üñºÔ∏è</span>
                {% endif %}
            </div>
            <div class="media-list-content">
                <div class="media-list-title">{{ image.title }}</div>
                <div class="media-list-details">
                    <span>üìÅ {{ image.project.name }}</span>
                    <span style="margin-left: 1rem;">{{ image.get_type_display }}</span>
                    <span style="margin-left: 1rem;">{{ image.created_at|date:"d/m/Y H:i" }}</span>
                </div>
            </div>
            <div class="media-list-status">
                <span class="media-status-badge status-{{ image.status }}">
                    {{ image.get_status_display }}
                </span>
            </div>
        </a>
        {% endwith %}
        {% endfor %}
    </div>
</div>
{% endif %}

<script>
function toggleView(mediaType, viewType) {
    const gridView = document.getElementById(`${mediaType}-grid-view`);
    const listView = document.getElementById(`${mediaType}-list-view`);
    const gridBtn = document.getElementById(`${mediaType}-grid-btn`);
    const listBtn = document.getElementById(`${mediaType}-list-btn`);
    
    if (viewType === 'grid') {
        gridView.classList.remove('hidden');
        listView.classList.add('hidden');
        gridBtn.classList.add('active');
        listBtn.classList.remove('active');
    } else {
        gridView.classList.add('hidden');
        listView.classList.remove('hidden');
        gridBtn.classList.remove('active');
        listBtn.classList.add('active');
    }
}
</script>
{% endblock %}

